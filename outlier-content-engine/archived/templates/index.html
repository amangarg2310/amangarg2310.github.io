{% extends "base.html" %}
{% block title %}Overview{% endblock %}
{% block page_title %}Overview{% endblock %}
{% block page_subtitle %}{{ profile.name }} â€” {{ profile.vertical }}{% endblock %}

{% block content %}

<!-- Quick Stats -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        </div>
        <div class="stat-value">{{ stats.total_posts }}</div>
        <div class="stat-label">Posts Tracked</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        </div>
        <div class="stat-value accent">{{ stats.total_outliers }}</div>
        <div class="stat-label">Outliers Found</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
        </div>
        <div class="stat-value">{{ stats.competitors }}</div>
        <div class="stat-label">Competitors</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
        </div>
        <div class="stat-value success">{{ stats.reports }}</div>
        <div class="stat-label">Reports Generated</div>
    </div>
</div>

<!-- Quick Actions -->
<div class="card">
    <div class="card-header">
        <div>
            <div class="card-title">Quick Actions</div>
            <div class="card-subtitle">Run the engine or manage your setup</div>
        </div>
    </div>
    <div class="flex gap-12" style="flex-wrap:wrap;">
        <form method="POST" action="{{ url_for('run_engine') }}" style="display:inline;">
            <button type="submit" class="btn btn-primary">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                Run Full Pipeline
            </button>
        </form>
        <form method="POST" action="{{ url_for('run_engine') }}" style="display:inline;">
            <input type="hidden" name="skip_collect" value="1">
            <button type="submit" class="btn btn-secondary">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
                Analyze Existing Data
            </button>
        </form>
        <a href="{{ url_for('competitors_page') }}" class="btn btn-outline">
            + Add Competitor
        </a>
    </div>
</div>

<!-- Competitor Overview -->
<div class="card">
    <div class="card-header">
        <div class="card-title">Competitors Being Monitored</div>
        <a href="{{ url_for('competitors_page') }}" class="btn btn-outline btn-sm">Manage</a>
    </div>
    {% if profile.competitors %}
    <div class="competitor-grid">
        {% for comp in profile.competitors %}
        <div class="competitor-card">
            <div class="competitor-name">{{ comp.name }}</div>
            <div class="competitor-platforms mt-8">
                {% for platform, handle in comp.handles.items() %}
                <span class="platform-badge">
                    {% if platform == 'instagram' %}
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5"/><circle cx="12" cy="12" r="5"/></svg>
                    {% elif platform == 'tiktok' %}
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89c.28 0 .54.04.79.1v-3.5a6.37 6.37 0 00-.79-.05A6.34 6.34 0 003.15 15.2a6.34 6.34 0 006.34 6.34 6.34 6.34 0 006.34-6.34V8.51a8.27 8.27 0 004.76 1.5v-3.4a4.85 4.85 0 01-1-.08z"/></svg>
                    {% else %}
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg>
                    {% endif %}
                    @{{ handle }}
                </span>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.5"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
        </div>
        <h3>No competitors yet</h3>
        <p>Add competitors to start tracking their content performance.</p>
        <a href="{{ url_for('competitors_page') }}" class="btn btn-primary">Add Your First Competitor</a>
    </div>
    {% endif %}
</div>

<!-- Recent Runs -->
<div class="card">
    <div class="card-header">
        <div class="card-title">Recent Runs</div>
    </div>
    {% if recent_runs %}
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Posts Collected</th>
                    <th>New Posts</th>
                    <th>Errors</th>
                    <th>Duration</th>
                </tr>
            </thead>
            <tbody>
                {% for run in recent_runs %}
                <tr>
                    <td>{{ run.run_timestamp }}</td>
                    <td>{{ run.posts_collected }}</td>
                    <td>{{ run.posts_new }}</td>
                    <td>
                        {% if run.errors and run.errors != '[]' %}
                        <span class="badge badge-danger">{{ run.error_count }}</span>
                        {% else %}
                        <span class="badge badge-success">None</span>
                        {% endif %}
                    </td>
                    <td>{{ run.duration_seconds }}s</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        </div>
        <h3>No runs yet</h3>
        <p>Run the pipeline to start collecting competitor data and finding outliers.</p>
    </div>
    {% endif %}
</div>

{% endblock %}
